import{j as e,b as ct,u as mt,r as a,A as dt,S as ut,F as pt,e as ht,T as ft,E as gt,v as xt,f as yt,g as ge}from"./index-BiH_W8qU.js";import{T as S}from"./TextInput-OEab8Aki.js";import{B as bt}from"./ButtonGroup-DkW5mFIv.js";import{C as Et}from"./Checkbox-BBACPq-K.js";import{u as _t}from"./useProgressNavStatus-Bp7VSg7A.js";import{A as ae}from"./Alert-dVt_nSqK.js";import{r as vt,c as It,n as jt,a as Bt}from"./helpers-D7gjf96R.js";import{H as xe}from"./index-G0GgqibQ.js";import{P as ye}from"./index.types-CnoW_BGG.js";import{u as St}from"./useRenewBackEndSession-D0AOcuzL.js";import{T as Ct}from"./Trans-aRS0WAyQ.js";import"./Error-CpiIyBEU.js";import"./Modal-DI8yWc2a.js";const Nt="https://ph-cp-d.snb.ca/ph-cp/95074049.aspx",At=()=>e.jsxs("form",{style:{display:"none"},id:"frmHostedCheckout",name:"frmHostedCheckout",method:"POST",action:Nt,children:[e.jsx("input",{type:"hidden",id:"gross_amt",name:"gross_amt"}),e.jsx("input",{type:"hidden",id:"return_url",name:"return_url"}),e.jsx("input",{type:"hidden",id:"customer_first_name",name:"customer_first_name"}),e.jsx("input",{type:"hidden",id:"customer_last_name",name:"customer_last_name"}),e.jsx("input",{type:"hidden",id:"customer_email",name:"customer_email"}),e.jsx("input",{type:"hidden",id:"customer_phone",name:"customer_phone"}),e.jsx("input",{type:"hidden",id:"pmt_method",name:"pmt_method"}),e.jsx("input",{type:"hidden",id:"reference1",name:"reference1"}),e.jsx("input",{type:"hidden",id:"reference2",name:"reference2"}),e.jsx("input",{type:"hidden",id:"language",name:"language"}),e.jsx("input",{type:"hidden",id:"app_cd",name:"app_cd"}),e.jsx("input",{type:"hidden",id:"timestamp",name:"timestamp"}),e.jsx("input",{type:"hidden",id:"channel",name:"channel"}),e.jsx("input",{type:"hidden",id:"agent",name:"agent"}),e.jsx("input",{type:"hidden",id:"receipt",name:"receipt"}),e.jsx("input",{type:"hidden",id:"emailreceipt",name:"emailreceipt"}),e.jsx("input",{type:"hidden",id:"freight",name:"freight"}),e.jsx("input",{type:"hidden",id:"return_url_receipt",name:"return_url_receipt"}),e.jsx("input",{type:"hidden",id:"return_url_receipt_text",name:"return_url_receipt_text"}),e.jsx("input",{type:"hidden",id:"totaltax",name:"TotalTax",value:"0.00"}),e.jsx("input",{type:"hidden",id:"taxxml",name:"taxxml"}),e.jsx("input",{type:"hidden",id:"ClientId",name:"ClientId",value:"0"}),e.jsx("input",{type:"hidden",id:"ClientId",name:"ExtClientId",value:"0"}),e.jsx("input",{type:"hidden",id:"OAConfirm",name:"OAConfirm",value:"false"}),e.jsx("input",{type:"hidden",id:"A3Logon",name:"A3Logon",value:"IAM_Test"}),e.jsx("input",{type:"hidden",id:"Line_item1",name:"Line_item1"}),e.jsx("input",{type:"input",id:"HashValue",name:"HashValue"}),e.jsx("button",{type:"submit",id:"phub-submit-button",children:"Submit"})]}),qt=()=>{const m=ct(),{t}=mt(["contactInformation","common"]),{progressNavList:d}=_t(),{state:be}=a.useContext(dt),{aboutTheService:Ee,eligibility:se,driverLicenceDetails:u,certification:_e,contactInformation:ve,common:Ie,cookies:je,startState:Be,resetState:g,sessionExpired:C}=be,{contactInformationFormStates:ie,handleFirstNameInputChange:Se,handleLastNameInputChange:Ce,handleTelephoneInputChange:Ne,handleEmailInputChange:Ae,handleCheckboxChange:Te,setInitialContactInfoStates:ke}=ve,{firstName:r,lastName:o,telephone:c,email:l,customerPermissionChecked:re}=ie,{languageCookies:Le}=je,{transactionId:Pe,updateTransactionId:He}=Ie;St();const[De,x]=a.useState(!1),[N,y]=a.useState(!1),[Me,A]=a.useState(""),[T,b]=a.useState(!1),[Fe,k]=a.useState(""),[L,P]=a.useState(!1),[oe,E]=a.useState(!1),[le,_]=a.useState(""),[ce,v]=a.useState(!1),[me,de]=a.useState(!1),[s,ue]=a.useState(!1),[pe,I]=a.useState(!1),Re=r&&o&&l,he=new URLSearchParams(window.location.search),fe=he.get("status"),j=he.get("transactionId");a.useEffect(()=>{C||!Ee.isChecked?m(d[0].link):se.questionOneAnswer!=="2"||se.questionTwoAnswer!=="4"?m(d[1].link):!u.driverLicenceDetailsStates.driverlicenceNumber||!u.driverLicenceDetailsStates.issuanceDateYear||!u.driverLicenceDetailsStates.issuanceDateMonth||!u.driverLicenceDetailsStates.issuanceDateDay||!u.driverLicenceDetailsStates.postalCode?m(d[2].link):_e.isChecked?j&&(He(j),Ve()):m(d[3].link)},[]);const Oe=n=>n.length===0?"":n.slice(0,3)+"-"+n.slice(3,6)+"-"+n.slice(6,10),Ve=async()=>{if(j)try{I(!0);const n=await xe.getPaymentDetails(j);n&&n.status===200&&n.data&&(n.data.transactionStatus===1?(g(),m(d[0].link)):(ke({customerPermissionChecked:!!n.data.customerPermissionChecked,firstName:n.data.firstName,lastName:n.data.lastName,telephone:Oe(n.data.phone),email:n.data.email}),vt(),fe===ye.DECLINED?de(!0):fe===ye.ERROR&&v(!0)),I(!1))}catch(n){console.error(n),g(),I(!1)}};a.useEffect(()=>{(r||o||c||l)&&x(!1)},[r,o,l,c,ie]),a.useEffect(()=>{(N||T||L||oe)&&x(!0)},[N,T,L,oe]),a.useEffect(()=>{C&&(ue(!0),y(!1),A(""),b(!1),k(""),E(!1),_(""),P(!1),v(!1),de(!1),I(!1))},[C]);const we=n=>{const{grossAmt:p,returnUrl:h,customerFirstName:f,customerLastName:i,customerEmail:B,customerPhone:ze,pmtMethod:Ge,reference1:Ke,reference2:Ye,language:Je,appCd:Qe,timestamp:We,channel:Xe,agent:Ze,receipt:$e,emailReceipt:et,freight:tt,returnUrlReceipt:nt,returnUrlReceiptText:at,taxXml:st,lineItem1:it,hashValue:rt}=n,H=document.getElementById("gross_amt"),D=document.getElementById("return_url"),M=document.getElementById("customer_first_name"),F=document.getElementById("customer_last_name"),R=document.getElementById("customer_email"),O=document.getElementById("customer_phone"),V=document.getElementById("pmt_method"),w=document.getElementById("reference1"),U=document.getElementById("reference2"),q=document.getElementById("language"),z=document.getElementById("app_cd"),G=document.getElementById("timestamp"),K=document.getElementById("channel"),Y=document.getElementById("agent"),J=document.getElementById("receipt"),Q=document.getElementById("emailreceipt"),W=document.getElementById("freight"),X=document.getElementById("return_url_receipt"),Z=document.getElementById("return_url_receipt_text"),$=document.getElementById("taxxml"),ee=document.getElementById("Line_item1"),te=document.getElementById("HashValue");H==null||H.setAttribute("value",p),D==null||D.setAttribute("value",h),M==null||M.setAttribute("value",f),F==null||F.setAttribute("value",i),R==null||R.setAttribute("value",B),O==null||O.setAttribute("value",ze),V==null||V.setAttribute("value",Ge),w==null||w.setAttribute("value",Ke),U==null||U.setAttribute("value",Ye),q==null||q.setAttribute("value",Je),z==null||z.setAttribute("value",Qe),G==null||G.setAttribute("value",We),K==null||K.setAttribute("value",Xe),Y==null||Y.setAttribute("value",Ze),J==null||J.setAttribute("value",$e),Q==null||Q.setAttribute("value",et),W==null||W.setAttribute("value",tt),X==null||X.setAttribute("value",nt),Z==null||Z.setAttribute("value",at),$==null||$.setAttribute("value",st),ee==null||ee.setAttribute("value",it),te==null||te.setAttribute("value",rt);const ne=document.getElementById("phub-submit-button"),ot=setInterval(()=>{const lt=sessionStorage.getItem("startTime");Bt(lt)||x(!1),clearInterval(ot)},5e3);ne==null||ne.click()},Ue=()=>{v(!1);const n=xt(c.split("-").join("")),p=yt(l),h=ge(r),f=ge(o);x(!0),r?r&&!h?(y(!0),A("invalid")):r&&h&&y(!1):(y(!0),A("empty")),o?o&&!f?(b(!0),k("invalid")):o&&f&&b(!1):(b(!0),k("empty")),P(c?!n:!1),l&&!p?(E(!0),_("invalid")):l?l&&p&&(_(""),E(!1)):(_("empty"),E(!0)),Re&&p&&h&&f&&(!c||c&&n)&&xe.PHUBIntegration(Pe,{languageCode:Le,customerFirstName:r,customerLastName:o,customerPhone:c.split("-").join(""),customerEmail:l,customerContactPermission:re}).then(i=>{const B=i==null?void 0:i.data;we({...B.phubHashObject,hashValue:B.hash})}).catch(i=>{(i==null?void 0:i.status)===401?(ue(!0),g()):(console.error(i),v(!0))})},qe=()=>{m(d[3].link)};return e.jsxs(e.Fragment,{children:[pe&&e.jsx(ut,{size:"lg"}),!pe&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"margin-bottom-xs margin-top-lg",children:t("heading",{ns:"contactInformation"})}),e.jsxs("p",{children:[e.jsx("span",{className:"required",children:"*"})," ",t("disclaimer",{ns:"common"})]}),ce&&e.jsx(ae,{isOpen:ce,type:"critical",description:t("systemErrorMsg",{ns:"common"}),variant:"inline"}),me&&e.jsx(ae,{isOpen:me,type:"critical",description:t("declinedErrorMsg",{ns:"contactInformation"}),variant:"inline"}),s&&e.jsx("div",{className:"feedback-fade-in",children:e.jsx(ae,{isOpen:s,variant:"inPage",type:"critical",description:e.jsx(e.Fragment,{children:e.jsx("p",{children:e.jsx(Ct,{i18nKey:"timeoutMsg",ns:"common",components:{1:e.jsx("a",{href:It(t("progressNav.homeUrl",{ns:"common"})),children:t("header")})}})})})})}),e.jsxs("div",{className:"padding-top-md padding-bottom-md row"+(s?" opacity-dk disabled-form":""),children:[e.jsxs("div",{className:"col-lg-8",children:[e.jsx(S,{label:t("form.firstName.label",{ns:"contactInformation"}),type:"text",value:r,error:N?t("form.firstName.errorMsg."+Me,{ns:"contactInformation"}):"",id:"SNB_First_Nam",maxlength:pt,onChange:Se,required:!0,disabled:s}),e.jsx(S,{label:t("form.lastName.label",{ns:"contactInformation"}),type:"text",value:o,error:T?t("form.lastName.errorMsg."+Fe,{ns:"contactInformation"}):"",id:"SNB_Fam_Nam",maxlength:ht,onChange:Ce,required:!0,disabled:s}),e.jsx(S,{label:t("form.telephone.label",{ns:"contactInformation"}),type:"tel",value:c,error:L?t("form.telephone.errorMsg"):"",id:"SNB_D_phone",maxlength:ft,onChange:Ne,placeholder:t("form.telephone.placeholder",{ns:"contactInformation"}),disabled:s}),e.jsx(S,{label:t("form.email.label",{ns:"contactInformation"}),type:"email",value:l,helperText:t("form.email.helpText",{ns:"contactInformation"}),error:le?t("form.email.errorMsg."+le,{ns:"contactInformation"}):"",id:"SNB_Email",maxlength:gt,onChange:Ae,required:!0,placeholder:t("form.email.placeholder",{ns:"contactInformation"}),disabled:s})]}),e.jsx(Et,{isChecked:re,handleCheckboxChange:Te,label:t("form.checkbox",{ns:"contactInformation"}),id:"contact-information-checkbox",disabled:s}),e.jsx(bt,{hasSecondaryBtn:!0,hasLinkBtn:!0,primaryButtonLabel:t("continueButton",{ns:"contactInformation"}),secondaryButtonLabel:t("buttonText.back",{ns:"common"}),linkButtonLabel:t("buttonText.cancel",{ns:"common"}),disabledPrimaryBtn:De||s,disableSecondaryBtn:s,disableLinkBtn:s,handlePrimaryClick:Ue,handleSecondaryClick:qe,handleLinkButtonClick:()=>(sessionStorage.removeItem("appState"),g(),Be(),m(d[0].link),jt(t("driversLicenceInfoURL",{ns:"common"})))})]})]}),e.jsx(At,{})]})};export{qt as default};
