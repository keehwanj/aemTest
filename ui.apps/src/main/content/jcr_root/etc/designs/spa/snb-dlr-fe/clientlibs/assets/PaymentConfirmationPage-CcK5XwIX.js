import{u as R,j as e,R as Y,b as Z,r as t,A as ee,S as ae,h as se,k as te,l as re}from"./index-BiH_W8qU.js";import{A as p,B as ne}from"./Alert-dVt_nSqK.js";import{H as $}from"./index-G0GgqibQ.js";import{P as I}from"./index.types-CnoW_BGG.js";import{u as ie}from"./useProgressNavStatus-Bp7VSg7A.js";import{c as q,k as oe,r as le}from"./helpers-D7gjf96R.js";import{F as ce}from"./FeedbackModal-PkVun4RZ.js";import{u as de}from"./useRenewBackEndSession-D0AOcuzL.js";import{T as v}from"./Trans-aRS0WAyQ.js";import"./Modal-DI8yWc2a.js";import"./ButtonGroup-DkW5mFIv.js";const S=s=>{const{t:d}=R(["common"]);return d("currency",{val:s,minimumFractionDigits:2})},me=({itemNumber:s,price:d,quantity:j,itemTotal:g,subtotal:k,total:N,authorizationNum:E,dateTime:L,hstNum:f,paymentMethod:D,phone:y,reference:o})=>{const{t:a}=R(["paymentConfirmation"]),h=[{label:a("orderSummary.reference"),value:o},{label:a("orderSummary.dateTime"),value:L},{label:a("orderSummary.hst"),value:f},{label:a("orderSummary.paymentMethod"),value:D},{label:a("orderSummary.authorization"),value:E},{label:a("orderSummary.phone"),value:y}],b=[{label:a("orderSummary.table.item")},{label:a("orderSummary.table.name")},{label:a("orderSummary.table.price")},{label:a("orderSummary.table.quantity")},{label:a("orderSummary.table.total")}],m=[[{value:s},{value:a("orderSummary.table.itemDescription")},{value:S(d)},{value:j.toString()},{value:S(g)}],[{value:""},{value:""},{value:""},{value:a("orderSummary.table.subtotal")},{value:S(k)}],[{value:""},{value:""},{value:""},{value:a("orderSummary.table.total"),bold:!0},{value:S(N),bold:!0}]];return e.jsxs("div",{className:"padding-bottom-xl",children:[e.jsx("div",{className:"summary-details",children:h.map((n,i)=>e.jsxs(Y.Fragment,{children:[e.jsx("span",{className:"bold left-align",children:n.label}),e.jsx("span",{className:"left-align",children:n.value})]},i))}),e.jsx("p",{className:"margin-top-lg",children:a("orderSummary.currencyTaxesDisclaimer")}),e.jsx("div",{className:"gnb-table-container",children:e.jsxs("table",{className:"gnb-table",children:[e.jsx("caption",{className:"sr-only",children:a("orderSummary.heading")}),e.jsx("thead",{children:e.jsx("tr",{children:b.map((n,i)=>e.jsx("th",{scope:"col",children:n.label},i))})}),e.jsx("tbody",{children:m.map((n,i)=>e.jsx("tr",{children:n.map((l,x)=>e.jsx("td",{className:l!=null&&l.bold?"bold":"",children:l.value},x))},i))})]})})]})},ke=()=>{const{t:s,i18n:d}=R(["paymentConfirmation"]),j=Z(),{progressNavList:g}=ie(),{state:k}=t.useContext(ee),{cookies:N,startState:E,resetState:L,sessionExpired:f}=k,{languageCookies:D}=N,y=new URLSearchParams(window.location.search),o=y.get("status"),a=y.get("transactionId"),[h,b]=t.useState(!1),[m,n]=t.useState(!1),[i,l]=t.useState(!1),[x,T]=t.useState(),[C,M]=t.useState(""),[U,F]=t.useState(!1),[V,P]=t.useState(!0),[z,A]=t.useState(!1),[G,_]=t.useState(!1),[J,Q]=t.useState(!1),[B,H]=t.useState(!1);de(),t.useEffect(()=>{f&&(n(!0),b(!1),H(!1),T(null),A(!1),_(!1),M(""),P(!1))},[f]);const W=async()=>{if(a&&o===I.SUCCESS){try{const r=await $.getPaymentDetails(a);if(r&&r.status===200&&r.data){L(),E(),le(),T(r.data),b(!0);try{const O=(await $.processDLROrder(a,{languageCode:D??"en"})).data;M(O.pdf)}catch(u){console.error(u),l(!0)}}else console.error(r),F(!0)}catch(r){console.error(r),String(r).indexOf("401")>-1?n(!0):F(!0)}P(!1)}else a&&(o===I.ERROR||o===I.DECLINED)?j(`${g[4].link}?status=${o}&transactionId=${a}`):(F(!0),P(!1))};return t.useEffect(()=>{W()},[o]),V?e.jsx(ae,{}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"margin-bottom-xs margin-top-lg",children:s("heading")}),e.jsxs("div",{className:"margin-bottom-md",children:[B&&e.jsx("div",{className:"feedback-fade-in",children:e.jsx(p,{isOpen:B,variant:"inPage",type:"success",description:e.jsxs("div",{children:[e.jsx("h2",{children:s("successAlertTitle")}),e.jsx("p",{children:s("successAlertDescription")})]})})}),m&&e.jsx("div",{className:"feedback-fade-in",children:e.jsx(p,{isOpen:m,type:"critical",description:e.jsx(v,{i18nKey:"errors.timeout",ns:"paymentConfirmation",components:{1:e.jsx("a",{href:q(s("tdlPageAbout.url",{ns:"temporaryDriversLicence"})),children:s("title",{ns:"temporaryDriversLicence"})})}}),variant:"inline"})}),h&&e.jsx("div",{className:"feedback-fade-in",children:e.jsx(p,{isOpen:h,type:"success",description:s("success",{ns:"paymentConfirmation"}),variant:"inline"})}),U&&e.jsx("div",{className:"feedback-fade-in",children:e.jsx(p,{isOpen:U,type:"critical",description:e.jsx(v,{i18nKey:"errors.system",ns:"paymentConfirmation",components:{1:e.jsx("a",{href:"tel:18888322762",children:"1-888-832-2762"})}}),variant:"inline"})}),i&&e.jsx("div",{className:"feedback-fade-in",children:e.jsx(p,{isOpen:i,type:"critical",description:e.jsx(v,{i18nKey:"errors.MVSFail",ns:"paymentConfirmation",components:{1:e.jsx("a",{href:"tel:18888322762",children:"1-888-832-2762"})}}),variant:"inline"})})]}),e.jsx("p",{children:e.jsx(v,{i18nKey:"description",ns:"paymentConfirmation",components:{1:e.jsx("a",{href:q(s("tdlPageAbout.url",{ns:"temporaryDriversLicence"})),children:s("title",{ns:"temporaryDriversLicence"})})}})}),C&&e.jsx(ne,{variant:"primary",id:"download-drivers-licence",label:s("downloadLicenceButton"),disabled:!C||m,onClick:()=>{const r=atob(C),u=new Array(r.length);for(let c=0;c<r.length;c++)u[c]=r.charCodeAt(c);const O=new Uint8Array(u),X=new Blob([O],{type:"application/pdf"}),w=document.createElement("a"),K=URL.createObjectURL(X);if(w.href=K,w.download=d.language==="fr"?se:te,w.click(),URL.revokeObjectURL(K),!J){const c=setInterval(()=>{A(!0),_(!0),Q(!0),clearInterval(c)},re)}}}),x&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:s("orderSummary.heading")}),e.jsx(me,{...oe(x)})]}),a&&e.jsx("div",{className:G?"feedback-fade-in":"",children:e.jsx(ce,{transactionId:a,isFeedbackModalOpen:z,setIsFeedbackModalOpen:A,setFeedbackModalSuccess:H})})]})};export{ke as default};
